# frozen_string_literal: true

require 'spec_helper'

RSpec.describe ::Search::Elastic::VulnerabilityReadResponseMapper, feature_category: :vulnerability_management do
  let(:mapper) { described_class.new(response, options) }
  let(:options) { {} }
  let_it_be(:vulnerability_reads) { create_list(:vulnerability_read, 3) }

  let_it_be(:response) do
    {
      aggregations: 'test',
      hits: { total: { value: vulnerability_reads.count }, hits: [] }
    }.tap do |resp|
      vulnerability_reads.reverse_each do |vulnerability_read|
        resp[:hits][:hits] << { _id: vulnerability_read.id.to_s, _source: { vulnerability_id: vulnerability_read.id } }
      end
    end
  end

  describe '#records' do
    it 'returns vulnerability_read sql records' do
      expect(mapper.records).to eq(vulnerability_reads.sort_by(&:vulnerability_id).reverse)
    end
  end
end
