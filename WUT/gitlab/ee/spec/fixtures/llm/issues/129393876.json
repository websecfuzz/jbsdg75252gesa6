{
  "data": {
    "id": 129393876,
    "title": "BE: Add support for setting Work Item as parent to an Issue",
    "author_id": 411701,
    "project_id": 278964,
    "created_at": "2023-06-16 08:14:55 UTC",
    "updated_at": "2023-10-24 13:56:16 UTC",
    "description": "# Summary\n\n**Note:** This is part of https://gitlab.com/groups/gitlab-org/-/epics/9290, where we are planning to migrate Epics to Work Items.\n\nSince Epics to Work Items migration is scheduled to happen _before_ we're able to migrate legacy Issues to Work Items, we need a way to associate a legacy issue as a child to an Epic Work Item, this is only needed until Issues too are Work Items as then, we get parent-child relationships between Work Items for free via Hierarchy Widget that we built for OKRs via https://gitlab.com/groups/gitlab-org/-/epics/7864.",
    "milestone_id": 2969687,
    "iid": 415547,
    "updated_by_id": 3860200,
    "weight": 2,
    "confidential": false,
    "moved_to_id": null,
    "due_date": null,
    "lock_version": 4,
    "time_estimate": 0,
    "relative_position": -194466963,
    "service_desk_reply_to": null,
    "last_edited_at": "2023-06-16 08:22:38 UTC",
    "last_edited_by_id": 411701,
    "discussion_locked": null,
    "closed_at": "2023-09-11 14:58:26 UTC",
    "closed_by_id": 3860200,
    "state_id": 2,
    "duplicated_to_id": null,
    "promoted_to_epic_id": null,
    "health_status": "on_track",
    "external_key": null,
    "sprint_id": null,
    "blocking_issues_count": 1,
    "upvotes_count": 0,
    "work_item_type_id": 1,
    "namespace_id": 15846663,
    "start_date": null
  },
  "author": {
    "id": 411701,
    "username": "kushalpandya",
    "name": "Kushal Pandya"
  },
  "labels": [
    {
      "id": 992791,
      "title": "Deliverable",
      "color": "#428BCA",
      "project_id": null,
      "created_at": "2016-11-18 17:02:50 UTC",
      "updated_at": "2019-04-17 18:49:16 UTC",
      "template": false,
      "description": "Issues scheduled for the current milestone.",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    },
    {
      "id": 2492649,
      "title": "backend",
      "color": "#D10069",
      "project_id": null,
      "created_at": "2017-08-15 14:49:42 UTC",
      "updated_at": "2018-06-11 10:34:33 UTC",
      "template": false,
      "description": "Issues that require backend work",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    },
    {
      "id": 3103451,
      "title": "devops::plan",
      "color": "#E44D2A",
      "project_id": null,
      "created_at": "2017-12-01 19:00:23 UTC",
      "updated_at": "2022-05-11 06:40:37 UTC",
      "template": false,
      "description": "Issues for the Plan stage of the DevOps lifecycle (e.g. Project Management, Agile Portfolio Management, Requirements Management)",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    },
    {
      "id": 10690700,
      "title": "group::product planning",
      "color": "#A8D695",
      "project_id": null,
      "created_at": "2019-05-22 19:55:52 UTC",
      "updated_at": "2020-10-16 19:33:41 UTC",
      "template": false,
      "description": "Issues belonging to the Product Planning group of the Plan stage of the DevOps lifecycle. See https://about.gitlab.com/handbook/product/product-categories/#product-planning-group",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    },
    {
      "id": 14918378,
      "title": "section::dev",
      "color": "#F0AD4E",
      "project_id": null,
      "created_at": "2020-05-11 22:11:57 UTC",
      "updated_at": "2020-05-11 22:11:57 UTC",
      "template": false,
      "description": "Issues related to the Dev section",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    },
    {
      "id": 10230929,
      "title": "type::feature",
      "color": "#009966",
      "project_id": null,
      "created_at": "2019-04-09 12:29:58 UTC",
      "updated_at": "2022-03-28 23:33:53 UTC",
      "template": false,
      "description": "Any issue/MR that contains work to support the implementation of a feature and/or results in an improvement in the user experience. Read more at https://about.gitlab.com/handbook/engineering/metrics/#work-type-classification",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    },
    {
      "id": 25541419,
      "title": "work items",
      "color": "#428BCA",
      "project_id": null,
      "created_at": "2022-06-13 14:41:30 UTC",
      "updated_at": "2022-06-13 14:41:30 UTC",
      "template": false,
      "description": "Related to the Work Items feature",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    },
    {
      "id": 28669354,
      "title": "workflow::complete",
      "color": "#428BCA",
      "project_id": null,
      "created_at": "2023-01-12 00:18:59 UTC",
      "updated_at": "2023-01-12 17:27:43 UTC",
      "template": false,
      "description": "Applied after all MRs have merged and the issue has been verified if necessary",
      "type": "GroupLabel",
      "group_id": 9970,
      "lock_on_merge": false
    }
  ],
  "epic_id": 864661,
  "milestone": {
    "id": 2969687,
    "title": "16.4",
    "project_id": null,
    "description": "",
    "due_date": "2023-09-17",
    "created_at": "2023-02-01 16:04:08 UTC",
    "updated_at": "2023-02-01 16:04:08 UTC",
    "state": "active",
    "iid": 91,
    "start_date": "2023-08-18",
    "group_id": 9970,
    "lock_version": 0
  },
  "iteration": null,
  "iterations_cadence": null,
  "notes": [
    {
      "note": "Yes, because Issues and Work Items live in the same table, while Epics are in a different table. Also, the work we're doing to allow linking Work Items with each other will cut some effort for us to make Issue - Work Item linking too.",
      "noteable_type": "Issue",
      "author_id": 411701,
      "created_at": "2023-07-26 14:41:16 UTC",
      "updated_at": "2023-07-26 16:08:02 UTC",
      "project_id": 278964,
      "attachment": null,
      "line_code": null,
      "commit_id": null,
      "noteable_id": 129393876,
      "st_diff": null,
      "system": false,
      "updated_by_id": null,
      "type": "DiscussionNote",
      "position": null,
      "original_position": null,
      "resolved_at": null,
      "resolved_by_id": null,
      "discussion_id": "c8f2f81bfb4c4913c0bb4abf415337bc1a6b40f9",
      "change_position": null,
      "resolved_by_push": null,
      "review_id": null,
      "confidential": false,
      "last_edited_at": null,
      "internal": false,
      "id": 1489084276,
      "namespace_id": null
    },
    {
      "note": "@amandarueda Since Work Items live in same table as Issues, the effort to add support for relating Work Item to a legacy issue isn't as much (we can technically fetch a legacy Issue via Work Items API even today!), so I don't think we need multiple issues to track this effort. :thumbsup:",
      "noteable_type": "Issue",
      "author_id": 411701,
      "created_at": "2023-07-26 11:53:36 UTC",
      "updated_at": "2023-07-26 11:53:36 UTC",
      "project_id": 278964,
      "attachment": null,
      "line_code": null,
      "commit_id": null,
      "noteable_id": 129393876,
      "st_diff": null,
      "system": false,
      "updated_by_id": null,
      "type": "DiscussionNote",
      "position": null,
      "original_position": null,
      "resolved_at": null,
      "resolved_by_id": null,
      "discussion_id": "c8f2f81bfb4c4913c0bb4abf415337bc1a6b40f9",
      "change_position": null,
      "resolved_by_push": null,
      "review_id": null,
      "confidential": false,
      "last_edited_at": null,
      "internal": false,
      "id": 1488778366,
      "namespace_id": null
    },
    {
      "note": "@kushalpandya based on the extended scope of the compatibility needs (relating a work item to an issuable), can you please create additional issues or update the specs of the existing issues for this new requirement?",
      "noteable_type": "Issue",
      "author_id": 2890431,
      "created_at": "2023-07-21 19:24:12 UTC",
      "updated_at": "2023-07-26 11:53:36 UTC",
      "project_id": 278964,
      "attachment": null,
      "line_code": null,
      "commit_id": null,
      "noteable_id": 129393876,
      "st_diff": null,
      "system": false,
      "updated_by_id": null,
      "type": "DiscussionNote",
      "position": null,
      "original_position": null,
      "resolved_at": null,
      "resolved_by_id": null,
      "discussion_id": "c8f2f81bfb4c4913c0bb4abf415337bc1a6b40f9",
      "change_position": null,
      "resolved_by_push": null,
      "review_id": null,
      "confidential": null,
      "last_edited_at": null,
      "internal": false,
      "id": 1482245564,
      "namespace_id": null
    },
    {
      "note": "To confirm @kushalpandya, the effort is minimal specifically for an `issue - work item` relationship, but an `epic - work item` relationship is what would cost us 3+ milestones, correct?",
      "noteable_type": "Issue",
      "author_id": 2890431,
      "created_at": "2023-07-26 14:29:38 UTC",
      "updated_at": "2023-07-26 14:29:38 UTC",
      "project_id": 278964,
      "attachment": null,
      "line_code": null,
      "commit_id": null,
      "noteable_id": 129393876,
      "st_diff": null,
      "system": false,
      "updated_by_id": null,
      "type": "DiscussionNote",
      "position": null,
      "original_position": null,
      "resolved_at": null,
      "resolved_by_id": null,
      "discussion_id": "c8f2f81bfb4c4913c0bb4abf415337bc1a6b40f9",
      "change_position": null,
      "resolved_by_push": null,
      "review_id": null,
      "confidential": false,
      "last_edited_at": null,
      "internal": false,
      "id": 1489060569,
      "namespace_id": null
    },
    {
      "note": "Thanks @egrieff! The implementation plan looks ideal. :thumbsup:",
      "noteable_type": "Issue",
      "author_id": 411701,
      "created_at": "2023-09-01 08:28:36 UTC",
      "updated_at": "2023-09-01 10:19:26 UTC",
      "project_id": 278964,
      "attachment": null,
      "line_code": null,
      "commit_id": null,
      "noteable_id": 129393876,
      "st_diff": null,
      "system": false,
      "updated_by_id": null,
      "type": "DiscussionNote",
      "position": null,
      "original_position": null,
      "resolved_at": null,
      "resolved_by_id": null,
      "discussion_id": "af7d4722628505e79274ce8357471c1447c484b9",
      "change_position": null,
      "resolved_by_push": null,
      "review_id": null,
      "confidential": false,
      "last_edited_at": null,
      "internal": false,
      "id": 1538970055,
      "namespace_id": null
    },
    {
      "note": "@kushalpandya I compiled a list of tasks needed to support this. \n\n~frontend \n\n- Display hierarchy widget for work items with type `Epic`\n  <details><summary>example</summary>\n\n  ![Screenshot_2023-08-31_at_16.06.38](/uploads/1cf3d7a19135056efda506ff3b7ac0b5/Screenshot_2023-08-31_at_16.06.38.png)\n\n  </details>\n- Include `add` dropdown to allow creating and linking a new issue\n  - When creating a new issue, this will be a work item\n  - For adding an existing issue, the [autocomplete query](https://gitlab.com/gitlab-org/gitlab/-/blob/master/app/assets/javascripts/work_items/graphql/project_work_items.query.graphql) should fetch work items with `Issue` type (which includes legacy issues too). Selecting the issue adds it as a child and displays it in the list\n- When visiting the legacy issue, we need to be able to see the work item epic in the sidebar. We currently fetch the epic using [project_issue_epic.mutation.graphql](https://gitlab.com/gitlab-org/gitlab/-/blob/master/ee/app/assets/javascripts/sidebar/queries/project_issue_epic.mutation.graphql) but we'll also have to check if a parent work item is present. We can use the following query:\n\n```graphql\nquery getParent {\n  workItem(id: \"gid://gitlab/WorkItem/<LEGACY_ISSUE_ID>\") {\n    widgets {\n      ... on WorkItemWidgetHierarchy {\n        parent {\n          id\n          title\n          webUrl\n        }\n      }\n    }\n  }\n}\n```\n\n~backend \n\n- ~~Migration to add `WorkItems::HierarchyRestriction` for epic type~~ - Done in https://gitlab.com/gitlab-org/gitlab/-/merge_requests/127917) \n- Add validation to prevent setting a parent epic (work item) if the issue already has a legacy epic assigned. Additionally, prevent setting a legacy epic if a parent epic (work item) is already present.\n\nI can go ahead and create tasks for these if you agree with the approach.\n\nSomething to keep in mind, we can display the epic in the legacy issue's sidebar but no other functionality can be supported without creating a legacy epic for every work item epic that is assigned to a legacy issue.",
      "noteable_type": "Issue",
      "author_id": 3860200,
      "created_at": "2023-08-31 16:27:52 UTC",
      "updated_at": "2023-09-01 13:33:32 UTC",
      "project_id": 278964,
      "attachment": null,
      "line_code": null,
      "commit_id": null,
      "noteable_id": 129393876,
      "st_diff": null,
      "system": false,
      "updated_by_id": null,
      "type": "DiscussionNote",
      "position": null,
      "original_position": null,
      "resolved_at": null,
      "resolved_by_id": null,
      "discussion_id": "af7d4722628505e79274ce8357471c1447c484b9",
      "change_position": null,
      "resolved_by_push": null,
      "review_id": null,
      "confidential": null,
      "last_edited_at": null,
      "internal": false,
      "id": 1537940828,
      "namespace_id": null
    },
    {
      "note": "Closing as all tasks are completed. Frontend tasks were promoted to issues so they can be tracked independently with https://gitlab.com/gitlab-org/gitlab/-/issues/423981 and https://gitlab.com/gitlab-org/gitlab/-/issues/423984",
      "noteable_type": "Issue",
      "author_id": 3860200,
      "created_at": "2023-09-11 14:58:26 UTC",
      "updated_at": "2023-09-11 15:23:55 UTC",
      "project_id": 278964,
      "attachment": null,
      "line_code": null,
      "commit_id": null,
      "noteable_id": 129393876,
      "st_diff": null,
      "system": false,
      "updated_by_id": null,
      "type": null,
      "position": null,
      "original_position": null,
      "resolved_at": null,
      "resolved_by_id": null,
      "discussion_id": "0e9571499e4d26d0241d9038fab4d3b57c0760d1",
      "change_position": null,
      "resolved_by_push": null,
      "review_id": null,
      "confidential": null,
      "last_edited_at": null,
      "internal": false,
      "id": 1553333989,
      "namespace_id": null
    }
  ],
  "note_authors": [
    {
      "id": 411701,
      "username": "kushalpandya",
      "name": "Kushal Pandya"
    },
    {
      "id": 411701,
      "username": "kushalpandya",
      "name": "Kushal Pandya"
    },
    {
      "id": 2890431,
      "username": "amandarueda",
      "name": "Amanda Rueda"
    },
    {
      "id": 2890431,
      "username": "amandarueda",
      "name": "Amanda Rueda"
    },
    {
      "id": 411701,
      "username": "kushalpandya",
      "name": "Kushal Pandya"
    },
    {
      "id": 3860200,
      "username": "egrieff",
      "name": "Eugenia Grieff"
    },
    {
      "id": 3860200,
      "username": "egrieff",
      "name": "Eugenia Grieff"
    }
  ],
  "namespace_hierarchy": [
    {
      "id": 9970,
      "name": "GitLab.org",
      "path": "gitlab-org",
      "type": "Group"
    },
    {
      "id": 278964,
      "name": "GitLab",
      "path": "gitlab",
      "type": "Project",
      "project_namespace_id": 15846663
    }
  ]
}
