# frozen_string_literal: true

module Search
  module Elastic
    module VulnerabilityManagementHelper
      extend ActiveSupport::Concern

      private

      # We do not require old_namespace_id as the deletion logic ignores docs with traversal_id and deletes other ones.
      def delete_vulnerabilities_with_old_routing(project)
        return unless ::Gitlab::CurrentSettings.elasticsearch_indexing?

        ::Search::Elastic::DeleteWorker.perform_async(
          task: :delete_project_vulnerabilities,
          traversal_id: project.namespace.elastic_namespace_ancestry, # new traversal_id
          project_id: project.id
        )
      end
    end
  end
end
