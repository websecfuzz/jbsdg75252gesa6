<script>
import { GlTab, GlBadge } from '@gitlab/ui';
import { SEVERITY_COUNT_LIMIT } from 'ee/vulnerabilities/constants';
import { s__, sprintf } from '~/locale';
import VulnerabilityReport from './vulnerability_report.vue';

export default {
  components: { GlTab, GlBadge, VulnerabilityReport },
  props: {
    title: {
      type: String,
      required: true,
    },
    isActiveTab: {
      type: Boolean,
      required: true,
    },
    filterDropdowns: {
      type: Array,
      required: true,
    },
    fields: {
      type: Array,
      required: true,
    },
    filterFn: {
      type: Function,
      required: false,
      default: (filters) => filters,
    },
  },
  data() {
    return {
      counts: [],
    };
  },
  computed: {
    countsSum() {
      const sum = this.counts.reduce((acc, { count }) => acc + count, 0);
      if (sum > SEVERITY_COUNT_LIMIT) {
        return sprintf(s__('SecurityReports|%{count}+'), { count: SEVERITY_COUNT_LIMIT });
      }

      return sum;
    },
  },
  methods: {
    updateCounts(counts) {
      this.counts = counts;
    },
  },
};
</script>

<template>
  <gl-tab>
    <template #title>
      <span>{{ title }}</span>
      <gl-badge class="gl-tab-counter-badge">{{ countsSum }}</gl-badge>
    </template>

    <slot name="header"></slot>

    <slot>
      <vulnerability-report
        class="gl-mt-7"
        :is-visible="isActiveTab"
        :filter-dropdowns="filterDropdowns"
        :fields="fields"
        :filter-fn="filterFn"
        show-counts
        @counts-changed="updateCounts"
      />
    </slot>
  </gl-tab>
</template>
