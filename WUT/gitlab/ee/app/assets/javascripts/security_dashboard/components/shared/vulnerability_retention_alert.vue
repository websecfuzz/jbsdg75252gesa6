<script>
import { unescape } from 'lodash';
import { GlAlert } from '@gitlab/ui';
import { sanitize } from '~/lib/dompurify';
import { helpPagePath } from '~/helpers/help_page_helper';
import UserCalloutDismisser from '~/vue_shared/components/user_callout_dismisser.vue';
import { s__ } from '~/locale';

export default {
  components: {
    GlAlert,
    UserCalloutDismisser,
  },
  inject: ['showRetentionAlert'],
  i18n: {
    message: unescape(
      sanitize(
        s__(
          'SecurityReports|Starting 2025-05-15, we will gradually migrate vulnerabilities that have not been updated in the last 12 months to the vulnerability archive. Archived vulnerabilities are stored for 3 years before deletion. To access the archive, on the left sidebar, select Secure &gt; Security Configuration &gt; Vulnerability Management.',
        ),
        { ALLOWED_TAGS: [] },
      ),
    ),
  },
  learnMorePath: helpPagePath('/user/application_security/vulnerability_archival/_index.md'),
};
</script>

<template>
  <user-callout-dismisser v-if="showRetentionAlert" feature-name="vulnerability_archival">
    <template #default="{ dismiss, shouldShowCallout }">
      <gl-alert
        v-if="shouldShowCallout"
        :title="s__('SecurityReports|Coming soon: time-based data retention limits')"
        :primary-button-text="__('Learn more')"
        :primary-button-link="$options.learnMorePath"
        variant="warning"
        class="gl-mt-5"
        dismissible
        @dismiss="dismiss"
      >
        <p>{{ $options.i18n.message }}</p>
      </gl-alert>
    </template>
  </user-callout-dismisser>
</template>
