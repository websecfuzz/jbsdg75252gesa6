<script>
import { isSubGroup } from '../utils';
import VulnerabilityIndicator from './vulnerability_indicator.vue';
import VulnerabilityPopover from './vulnerability_popover.vue';

export default {
  name: 'VulnerabilityCell',
  components: {
    VulnerabilityIndicator,
    VulnerabilityPopover,
  },
  props: {
    item: {
      type: Object,
      required: true,
    },
    index: {
      type: Number,
      required: true,
    },
  },
  computed: {
    isSubGroup() {
      return isSubGroup(this.item);
    },
    severityCounts() {
      const { vulnerabilityNamespaceStatistic, vulnerabilityStatistic } = this.item;
      return this.isSubGroup ? vulnerabilityNamespaceStatistic : vulnerabilityStatistic;
    },
    webUrl() {
      return this.item.webUrl;
    },
    popoverTargetId() {
      return `vulnerabilities-count-${this.index}`;
    },
  },
};
</script>

<template>
  <div>
    <div :id="popoverTargetId" class="gl-cursor-pointer">
      <vulnerability-indicator :counts="severityCounts" />
    </div>
    <vulnerability-popover
      :severity-counts="severityCounts"
      :web-url="webUrl"
      :target-id="popoverTargetId"
      :is-sub-group="isSubGroup"
    />
  </div>
</template>
