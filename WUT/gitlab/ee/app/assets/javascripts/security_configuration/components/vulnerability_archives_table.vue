<script>
import { GlTableLite, GlButton } from '@gitlab/ui';
import { s__, __ } from '~/locale';
import { getMonthNames } from '~/lib/utils/datetime_utility';

const monthNames = getMonthNames();

export default {
  components: {
    GlButton,
    GlTableLite,
  },
  props: {
    items: {
      type: Array,
      required: false,
      default: () => [],
    },
    year: {
      type: Number,
      required: true,
    },
    preparingExportForPeriod: {
      type: String,
      required: false,
      default: '',
    },
  },
  methods: {
    getMonthName(number) {
      return monthNames[number];
    },
    emitDownload({ month }) {
      this.$emit('download', month);
    },
  },
  fields: [
    {
      key: 'month',
      label: __('Month'),
      thClass: '!gl-border-none',
      tdClass: '!gl-border-b-0 !gl-align-middle',
    },
    {
      key: 'count',
      label: s__('SecurityConfiguration|Vulnerabilities'),
      thClass: '!gl-border-none',
      tdClass: '!gl-border-b-0 !gl-align-middle',
    },
    {
      key: 'download',
      label: __('Download'),
      thClass: 'gl-text-right !gl-border-none',
      tdClass: '!gl-border-b-0 !gl-align-middle',
    },
  ],
};
</script>
<template>
  <gl-table-lite :fields="$options.fields" :items="items" table-class="gl-mb-0">
    <template #cell(month)="{ item = {} }">
      {{ getMonthName(item.month) }}
    </template>
    <template #cell(count)="{ item = {} }">
      {{
        n__(
          'SecurityConfiguration|1 vulnerability',
          'SecurityConfiguration|%d vulnerabilities',
          item.count,
        )
      }}
    </template>
    <template #cell(download)="{ item = {} }">
      <div class="gl-text-right">
        <gl-button
          icon="download"
          :loading="preparingExportForPeriod === `${year}-${item.month}`"
          :aria-label="__('Download')"
          @click="emitDownload(item)"
        />
      </div>
    </template>
  </gl-table-lite>
</template>
