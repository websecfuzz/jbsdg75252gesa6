<script>
import { GlFormGroup, GlFormInput } from '@gitlab/ui';
import { s__, __ } from '~/locale';
import MarkdownEditor from '~/vue_shared/components/markdown/markdown_editor.vue';
import SettingsSection from '~/vue_shared/components/settings/settings_section.vue';
import * as i18n from './i18n';

export default {
  components: {
    GlFormGroup,
    GlFormInput,
    MarkdownEditor,
    SettingsSection,
  },
  inject: ['markdownDocsPath', 'markdownPreviewPath'],
  props: {
    validationState: {
      type: Object,
      required: false,
      default: () => ({}),
    },
  },
  data() {
    return {
      isSubmitting: false,
      vulnerabilityName: '',
      vulnerabilityDesc: '',
      formFieldProps: {
        id: 'form-vulnerability-desc',
        name: 'form-vulnerability-desc',
        'aria-label': this.$options.i18n.vulnerabilityDesc.description,
        placeholder: this.$options.i18n.vulnerabilityDesc.description,
      },
    };
  },
  methods: {
    emitChanges() {
      this.$emit('change', {
        vulnerabilityName: this.vulnerabilityName,
        vulnerabilityDesc: this.vulnerabilityDesc,
      });
    },
  },
  i18n: {
    errorName: i18n.ERROR_NAME,
    vulnerabilityName: {
      label: __('Name'),
      description: s__(
        'VulnerabilityManagement|Vulnerability name or type. Ex: Cross-site scripting',
      ),
    },
    vulnerabilityDesc: {
      label: __('Description'),
      description: s__(
        'VulnerabilityManagement|Summary, detailed description, steps to reproduce, etc.',
      ),
    },
  },
};
</script>
<template>
  <settings-section>
    <gl-form-group
      :label="$options.i18n.vulnerabilityName.label"
      :description="$options.i18n.vulnerabilityName.description"
      :state="validationState.name"
      :invalid-feedback="$options.i18n.errorName"
      label-for="form-vulnerability-name"
      class="gl-mb-6"
    >
      <gl-form-input
        id="form-vulnerability-name"
        v-model.trim="vulnerabilityName"
        :state="validationState.name"
        type="text"
        @input="emitChanges"
      />
    </gl-form-group>
    <gl-form-group
      :label="$options.i18n.vulnerabilityDesc.label"
      label-for="form-vulnerability-desc"
    >
      <div class="gl-rounded-base gl-border-1 gl-border-solid gl-border-default">
        <markdown-editor
          v-model="vulnerabilityDesc"
          :disable-attachments="true"
          :render-markdown-path="markdownPreviewPath"
          :markdown-docs-path="markdownDocsPath"
          :is-submitting="isSubmitting"
          :form-field-props="formFieldProps"
          @input="emitChanges"
        />
      </div>
    </gl-form-group>
  </settings-section>
</template>
