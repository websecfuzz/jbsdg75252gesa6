<script>
import { GlIntersectionObserver, GlLink } from '@gitlab/ui';
import StatusBadge from 'ee/vue_shared/security_reports/components/status_badge.vue';
import { __ } from '~/locale';
import { setTabIndexForCodeFlowPage } from 'ee/vulnerabilities/helpers';

export default {
  name: 'StickyVulnerabilityHeader',
  components: {
    StatusBadge,
    GlIntersectionObserver,
    GlLink,
  },
  props: {
    tabs: {
      type: Array,
      required: true,
    },
    vulnerability: {
      type: Object,
      required: true,
    },
  },
  data() {
    return {
      isStickyHeaderVisible: false,
    };
  },
  methods: {
    setStickyHeaderVisible(val) {
      this.isStickyHeaderVisible = val;
    },
    navigateTo(index) {
      setTabIndexForCodeFlowPage(this.$router, { path: '/', index });
    },
  },
  i18n: {
    active: __('Active'),
  },
};
</script>

<template>
  <gl-intersection-observer
    class="gl-relative -gl-top-5 gl-z-200"
    @appear="setStickyHeaderVisible(false)"
    @disappear="setStickyHeaderVisible(true)"
  >
    <div
      data-testid="sticky-header"
      class="issue-sticky-header gl-border-b gl-fixed gl-bg-default"
      :class="{ 'gl-invisible': !isStickyHeaderVisible }"
    >
      <div
        class="issue-sticky-header-text container-limited gl-mx-auto gl-flex gl-w-full gl-flex-col gl-items-center gl-pt-4"
      >
        <div class="gl-flex gl-w-full gl-items-center gl-gap-2">
          <status-badge :state="vulnerability.state" class="gl-mr-3" />
          <gl-link
            href="#top"
            class="gl-my-0 gl-ml-1 gl-mr-2 gl-hidden gl-overflow-hidden gl-text-ellipsis gl-whitespace-nowrap gl-font-bold gl-text-default lg:gl-block"
            >{{ vulnerability.title }}</gl-link
          >
        </div>
        <div class="gl-flex gl-w-full">
          <ul
            class="merge-request-tabs nav-tabs nav nav-links gl-m-0 gl-flex gl-flex-nowrap gl-border-b-0 gl-p-0"
          >
            <li
              v-for="(tab, index) in tabs"
              :key="tab[0]"
              :class="{ active: tab[2] === `${$options.i18n.active}` }"
            >
              <gl-link
                href="#top"
                :data-action="tab[0]"
                class="!gl-py-4"
                @click="navigateTo(index)"
              >
                {{ tab[1] }}
              </gl-link>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </gl-intersection-observer>
</template>
