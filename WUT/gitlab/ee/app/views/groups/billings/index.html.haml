- page_title _("Billing")
- add_page_specific_style 'page_bundles/billings'
- read_only = !can_edit_billing?(@group)

= render_if_exists 'shared/thanks_for_purchase_alert', plan_title: plan_title, quantity: params[:purchased_quantity].to_i
= render 'shared/qrtly_reconciliation_alert', group: @group

- if @top_level_group # we are in subgroup mode
  - current_plan = subscription_plan_info(@plans_data, @top_level_group.actual_plan_name)
  = render 'subgroup_billing_plan_header',
    namespace: @group,
    current_plan: current_plan,
    top_level_group: @top_level_group
- else
  - content_for :hide_explore_paid_plans_button, true
  - current_plan = subscription_plan_info(@plans_data, @group.actual_plan_name)

  - if @group.paid? && !@group.trial?
    - if current_plan
      = render 'top_level_billing_plan_header', namespace: @group, current_plan: current_plan

      - if @targeted_message_id.present?
        = render Pajamas::BannerComponent.new(banner_options: { class: 'gl-mt-6 js-targeted-message', data: { namespace_id: @group.id, targeted_message_id: @targeted_message_id, dismiss_endpoint: targeted_message_dismissals_path } }, close_options: { class: 'js-close' },
          button_text: s_('TargettedMessages|Get in Touch'),
          button_link: "#{ApplicationHelper.promo_url}/pricing/smb-promo/") do |c|
          - c.with_title do
            = s_('TargettedMessages|Get access to both GitLab Premium and Duo Pro for %{strike}$48%{end_strike} $19 a month for a year!').html_safe % { strike: '<s>'.html_safe, end_strike: '</s>'.html_safe }
          %p
            = s_('TargettedMessages|With GitLab Premium and Duo Pro, youâ€™ll be able to stay ahead of the competition by shortening cycle times and increasing developer productivity. To take advantage of the offer, get in touch with our team today!')

    = render GitlabSubscriptions::DuoEnterpriseAlert::PremiumComponent.new(namespace: @group, user: current_user)
    = render GitlabSubscriptions::DuoEnterpriseAlert::UltimateComponent.new(namespace: @group, user: current_user)

    = render 'shared/billings/billing_plans', plans_data: @plans_data, namespace: @group, current_plan: current_plan, read_only: read_only

    - data_attributes = subscription_plan_data_attributes(@group, current_plan, read_only: read_only)
    #js-billing-plans{ data: data_attributes }
  - else
    = render 'free_and_trial_plan_billing_index', plans_data: @plans_data, namespace: @group, current_plan: current_plan, read_only: read_only
