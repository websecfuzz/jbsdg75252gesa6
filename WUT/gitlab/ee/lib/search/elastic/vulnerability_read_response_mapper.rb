# frozen_string_literal: true

module Search
  module Elastic
    class VulnerabilityReadResponseMapper < ResponseMapper
      extend ::Gitlab::Utils::Override

      override :records
      def records
        ::Vulnerabilities::Read.by_ids_desc(ids)
      end

      private

      override :ids
      def ids
        # the _source: vulnerability_id will always contain an integer
        @ids ||= results.map { |result| result[:_source][:vulnerability_id] }
      end
    end
  end
end
